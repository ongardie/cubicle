# This file is automatically generated from "src/bin/gen_github_yaml.rs".
# Do not modify it directly.

name: CI
on:
  pull_request: {}
  push:
    branches:
    - main
  schedule:
  - cron: 0 16 * * *
  workflow_dispatch: {}
jobs:
  system_test-macos-12-docker:
    name: System tests (macos-12, docker)
    runs-on: macos-12
    steps:
    - name: Install Docker
      run: brew install docker docker-machine
    - name: Create VirtualBox VM for Docker
      run: |
        docker-machine create \
            --driver virtualbox \
            --virtualbox-boot2docker-url 'https://github.com/boot2docker/boot2docker/releases/download/v19.03.12/boot2docker.iso' \
            --virtualbox-hostonly-cidr '192.168.56.1/24' \
            default && \
        eval "$(docker-machine env default)" && \
        env | grep DOCKER >> $GITHUB_ENV
    - name: Docker debian 11
      run: docker run --rm debian:11 sh -c 'env; echo $PATH; gpgv --version; dpkg -l debian-archive-keyring; apt-get update; for file in $(dpkg -L debian-archive-keyring); do [ -f $file ] && sha256sum $file; done; true'
    - name: Docker debian 12.2
      run: docker run --rm debian:12.2 sh -c 'env; echo $PATH; gpgv --version; dpkg -l debian-archive-keyring; apt-get update; for file in $(dpkg -L debian-archive-keyring); do [ -f $file ] && sha256sum $file; done; true'
    - name: Docker debian 12-slim
      run: docker run --rm debian:12-slim sh -c 'env; echo $PATH; gpgv --version; dpkg -l debian-archive-keyring; apt-get update; for file in $(dpkg -L debian-archive-keyring); do [ -f $file ] && sha256sum $file; done; true'
    - name: Docker debian 12
      run: docker run --rm debian:12 sh -c 'env; echo $PATH; gpgv --version; dpkg -l debian-archive-keyring; apt-get update; for file in $(dpkg -L debian-archive-keyring); do [ -f $file ] && sha256sum $file; done; true'
    - name: Docker debian testing
      run: docker run --rm debian:testing sh -c 'env; echo $PATH; gpgv --version; dpkg -l debian-archive-keyring; apt-get update; for file in $(dpkg -L debian-archive-keyring); do [ -f $file ] && sha256sum $file; done; true'
    - name: Abort
      run: 'false'
    - name: Download build artifact
      uses: actions/download-artifact@v3
      with:
        name: debug-dist-macos-12-stable
    - name: Unpack build artifact
      run: tar --directory .. --extract --verbose --file debug-dist.tar.gz
    - name: Run cub list
      run: ./target/debug/cub --config 'src/bin/system_test/github/docker.toml' list
      env:
        RUST_BACKTRACE: '1'
    - name: Run system test
      run: ./target/debug/system_test --config 'src/bin/system_test/github/docker.toml'
      env:
        INSTA_WORKSPACE_ROOT: .
        RUST_BACKTRACE: '1'
