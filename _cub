#compdef cub

_cub() {
    local line

    _arguments -C \
        "-h[Show help information]" \
        "--help[Show help information]" \
        "1: :((
            enter\:'Run a shell in an existing environment'
            exec\:'Run a command in an existing environment'
            list\:'Show existing environments'
            new\:'Create a new environment'
            purge\:'Delete an environment and its work directory'
            reset\:'Recreate an environment (keeping its work directory)'
            tmp\:'Create and enter a new temporary environment'
        ))" \
        "*::arg:->args"

    case $line[1] in
        enter) _cub_enter ;;
        exec) _cub_exec ;;
        list) _cub_list ;;
        new) _cub_new ;;
        purge) _cub_purge ;;
        reset) _cub_reset ;;
        tmp) _cub_tmp ;;
    esac
}

_cub_enter() {
    _arguments \
        "-h[Show help information]" \
        "--help[Show help information]" \
        "1: name[environment name]:_cub_envs"
}

_cub_exec() {
    _arguments \
        "-h[Show help information]" \
        "--help[Show help information]" \
        "1: name[environment name]:_cub_envs" \
        "2: command:( )" \
        "*: arg:( )"
}

_cub_list() {
    _arguments \
        "--format[Set output format]:format:(default json names)" \
        "-h[Show help information]" \
        "--help[Show help information]"
}

_cub_new() {
    _arguments \
        "--enter[Run a shell in new environment]" \
        "-h[Show help information]" \
        "--help[Show help information]" \
        "--seeds[Comma-separated names of archives to mix in]:seeds:()" \
        "*: name[environment name]:( )"
}

_cub_purge() {
    _arguments \
        "-h[Show help information]" \
        "--help[Show help information]" \
        "*: name[environment name]:_cub_envs"
}

_cub_reset() {
    _arguments \
        "--clean[Remove home directory and do not recreate it]" \
        "-h[Show help information]" \
        "--help[Show help information]" \
        "--seeds[Comma-separated names of archives to mix in]:seeds:( )" \
        "*: name[environment name]:_cub_envs"
}

_cub_tmp() {
    _arguments \
        "-h[Show help information]" \
        "--help[Show help information]" \
        "--seeds[Comma-separated names of archives to mix in]:seeds:()"
}

_cub_envs() {
    _values -w 'environments' $(cub list --format=names)
}

_cub
